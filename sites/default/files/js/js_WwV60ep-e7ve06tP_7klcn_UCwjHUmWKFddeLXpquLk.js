Drupal.locale = { 'pluralFormula': function ($n) { return Number(($n>1)); }, 'strings': {"":{"An AJAX HTTP error occurred.":"Une erreur HTTP AJAX s\u0027est produite.","HTTP Result Code: !status":"Code de statut HTTP : !status","An AJAX HTTP request terminated abnormally.":"Une requ\u00eate HTTP AJAX s\u0027est termin\u00e9e anormalement.","Debugging information follows.":"Informations de d\u00e9bogage ci-dessous.","Path: !uri":"Chemin : !uri","StatusText: !statusText":"StatusText: !statusText","ResponseText: !responseText":"ResponseText : !responseText","ReadyState: !readyState":"ReadyState : !readyState","Next":"Suivant","Status":"Statut","Remove":"Retirer","Disabled":"D\u00e9sactiv\u00e9","Enabled":"Activ\u00e9","Edit":"Modifier","Size":"Taille","None":"Aucun(e)","Link":"Lien","Parent":"Parent","Sunday":"Dimanche","Monday":"Lundi","Tuesday":"Mardi","Wednesday":"Mercredi","Thursday":"Jeudi","Friday":"Vendredi","Saturday":"Samedi","Add":"Ajouter","View":"Voir","Filename":"Nom du fichier","Configure":"Configurer","All":"Tout","Done":"Termin\u00e9","N\/A":"N\/A","Prev":"Pr\u00e9c.","Mon":"lun","Tue":"mar","Wed":"mer","Thu":"jeu","Fri":"ven","Sat":"sam","Sun":"dim","January":"janvier","February":"F\u00e9vrier","March":"mars","April":"avril","May":"mai","June":"juin","July":"juillet","August":"ao\u00fbt","September":"septembre","October":"octobre","November":"novembre","December":"d\u00e9cembre","Operation":"Op\u00e9ration","Show":"Afficher","Select all rows in this table":"S\u00e9lectionner toutes les lignes du tableau","Deselect all rows in this table":"D\u00e9s\u00e9lectionner toutes les lignes du tableau","Today":"Aujourd\u0027hui","Jan":"jan","Feb":"f\u00e9v","Mar":"mar","Apr":"avr","Jun":"juin","Jul":"juil","Aug":"ao\u00fb","Sep":"sep","Oct":"oct","Nov":"nov","Dec":"d\u00e9c","Su":"Di","Mo":"Lu","Tu":"Ma","We":"Me","Th":"Je","Fr":"Ve","Sa":"Sa","Not published":"Non publi\u00e9","Please wait...":"Veuillez patienter...","Hide":"Masquer","mm\/dd\/yy":"dd\/mm\/yy","By @name on @date":"Par @name le @date","By @name":"Par @name","Not in menu":"Pas dans le menu","Alias: @alias":"Alias : @alias","No alias":"Aucun alias","New revision":"Nouvelle r\u00e9vision","Drag to re-order":"Cliquer-d\u00e9poser pour r\u00e9-organiser","Changes made in this table will not be saved until the form is submitted.":"Les changements effectu\u00e9s dans ce tableau ne seront pris en compte que lorsque la configuration aura \u00e9t\u00e9 enregistr\u00e9e.","The changes to these blocks will not be saved until the \u003Cem\u003ESave blocks\u003C\/em\u003E button is clicked.":"N\u0027oubliez pas de cliquer sur \u003Cem\u003EEnregistrer les blocs\u003C\/em\u003E pour confirmer les modifications apport\u00e9es ici.","This permission is inherited from the authenticated user role.":"Ce droit est h\u00e9rit\u00e9e du r\u00f4le de l\u0027utilisateur authentifi\u00e9.","No revision":"Aucune r\u00e9vision","Requires a title":"Titre obligatoire","Not restricted":"Non restreint","(active tab)":"(onglet actif)","Not customizable":"Non personnalisable","Restricted to certain pages":"R\u00e9serv\u00e9 \u00e0 certaines pages","The block cannot be placed in this region.":"Le bloc ne peut pas \u00eatre plac\u00e9 dans cette r\u00e9gion.","Hide summary":"Masquer le r\u00e9sum\u00e9","Edit summary":"Modifier le r\u00e9sum\u00e9","Don\u0027t display post information":"Ne pas afficher les informations de la contribution","The selected file %filename cannot be uploaded. Only files with the following extensions are allowed: %extensions.":"Le fichier s\u00e9lectionn\u00e9 %filename ne peut pas \u00eatre transf\u00e9r\u00e9. Seulement les fichiers avec les extensions suivantes sont permis : %extensions.","Re-order rows by numerical weight instead of dragging.":"R\u00e9-ordonner les lignes avec des poids num\u00e9riques plut\u00f4t qu\u0027en les d\u00e9pla\u00e7ant.","Show row weights":"Afficher le poids des lignes","Hide row weights":"Cacher le poids des lignes","Autocomplete popup":"Popup d\u0027auto-compl\u00e9tion","Searching for matches...":"Recherche de correspondances...","No results":"Aucun r\u00e9sultat","New":"Nouveau","Recent":"R\u00e9cent","Close":"Fermer","Loading token browser...":"Chargement de l\u0027explorateur de jetons...","Available tokens":"Jetons (tokens) disponibles","Insert this token into your form":"Ins\u00e9rer ce jeton (\u003Cem\u003Etoken\u003C\/em\u003E) dans votre formulaire","First click a text field to insert your tokens into.":"Cliquez d\u0027abord sur un champ de texte pour ins\u00e9rer vos jetons (\u003Cem\u003Etokens\u003C\/em\u003E) dans celui -ci.","Content can only be inserted into CKEditor in the WYSIWYG mode.":"Le contenu peut seulement \u00eatre ins\u00e9r\u00e9 dans CKEditor en mode WYSIWYG.","Inclusion: @value":"Inclusion : @value","Priority: @value":"Priorit\u00e9 : @value","Automatic alias":"Alias automatique","@label: @value":"@label: @value","Using defaults":"Utiliser les param\u00e8tres par d\u00e9faut.","Also allow !name role to !permission?":"Autoriser \u00e9galement le r\u00f4le !name \u00e0 !permission ?","Remove group":"Supprimer le groupe","Apply (all displays)":"Appliquer (tous les affichages)","Revert to default":"R\u00e9tablir par d\u00e9faut","Apply (this display)":"Appliquer (cet affichage)","Deselect all":"Tout d\u00e9s\u00e9lectionner","Select all":"Tout s\u00e9lectionner","Translate Text":"Traduire le texte","An HTTP error @status occured.":"Une erreur HTTP @status s\u0027est produite.","Thumbnail":"Miniature","You can\u0027t drop a resource of type %type in this field":"Vous ne pouvez pas d\u00e9poser une ressource du type %type dans ce champ","Edit atom properties":"\u0026Eacute;diter les propri\u00e9t\u00e9s du m\u00e9dia","Drop a resource from Scald media library here.":"D\u00e9posez une ressource \u00e0 partir de la librairie de m\u00e9dia.","Start upload":"D\u00e9marrer le transfert","CustomMessage: !customMessage":"Message personalis\u00e9 : !customMessage","The response failed verification so will not be processed.":"La v\u00e9rification de la r\u00e9ponse \u00e0 \u00e9chou\u00e9e, elle ne sera pas trait\u00e9e.","The callback URL is not local and not trusted: !url":"L\u0027URL de retour n\u0027est pas locale et n\u0027est pas de confiance : !url","Saving vote...":"Enregistrement du vote ...","Blank":"Vide","Link Target":"Cible du Lien","Select files":"S\u00e9lectionner des fichiers","Add files":"Ajouter des fichiers","Stop current upload":"Arr\u00eater le transfert en cours","Start uploading queue":"Commencer le transfert de la file","Uploaded %d\/%d files":"%d\/%d fichiers transf\u00e9r\u00e9s","Drag files here.":"Glisser des fichiers ici.","Init error.":"Erreur lors de l\u0027initialisation.","HTTP Error.":"Erreur HTTP.","Security error.":"Erreur de s\u00e9curit\u00e9.","Generic error.":"Erreur g\u00e9n\u00e9rique.","IO error.":"Erreur d\u0027entr\u00e9es\/sorties.","Stop upload":"Arr\u00eater le transfert","%d files queued":"%d fichiers ajout\u00e9s dans la file","Please wait while your files are being uploaded.":"Veuillez patienter pendant le transfert de vos fichiers."}} };;
(function ($) {

/**
 * Attaches double-click behavior to toggle full path of Krumo elements.
 */
Drupal.behaviors.devel = {
  attach: function (context, settings) {

    // Add hint to footnote
    $('.krumo-footnote .krumo-call').once().before('<img style="vertical-align: middle;" title="Click to expand. Double-click to show path." src="' + settings.basePath + 'misc/help.png"/>');

    var krumo_name = [];
    var krumo_type = [];

    function krumo_traverse(el) {
      krumo_name.push($(el).html());
      krumo_type.push($(el).siblings('em').html().match(/\w*/)[0]);

      if ($(el).closest('.krumo-nest').length > 0) {
        krumo_traverse($(el).closest('.krumo-nest').prev().find('.krumo-name'));
      }
    }

    $('.krumo-child > div:first-child', context).dblclick(
      function(e) {
        if ($(this).find('> .krumo-php-path').length > 0) {
          // Remove path if shown.
          $(this).find('> .krumo-php-path').remove();
        }
        else {
          // Get elements.
          krumo_traverse($(this).find('> a.krumo-name'));

          // Create path.
          var krumo_path_string = '';
          for (var i = krumo_name.length - 1; i >= 0; --i) {
            // Start element.
            if ((krumo_name.length - 1) == i)
              krumo_path_string += '$' + krumo_name[i];

            if (typeof krumo_name[(i-1)] !== 'undefined') {
              if (krumo_type[i] == 'Array') {
                krumo_path_string += "[";
                if (!/^\d*$/.test(krumo_name[(i-1)]))
                  krumo_path_string += "'";
                krumo_path_string += krumo_name[(i-1)];
                if (!/^\d*$/.test(krumo_name[(i-1)]))
                  krumo_path_string += "'";
                krumo_path_string += "]";
              }
              if (krumo_type[i] == 'Object')
                krumo_path_string += '->' + krumo_name[(i-1)];
            }
          }
          $(this).append('<div class="krumo-php-path" style="font-family: Courier, monospace; font-weight: bold;">' + krumo_path_string + '</div>');

          // Reset arrays.
          krumo_name = [];
          krumo_type = [];
        }
      }
    );
  }
};

})(jQuery);
;
(function ($) {

Drupal.behaviors.textarea = {
  attach: function (context, settings) {
    $('.form-textarea-wrapper.resizable', context).once('textarea', function () {
      var staticOffset = null;
      var textarea = $(this).addClass('resizable-textarea').find('textarea');
      var grippie = $('<div class="grippie"></div>').mousedown(startDrag);

      grippie.insertAfter(textarea);

      function startDrag(e) {
        staticOffset = textarea.height() - e.pageY;
        textarea.css('opacity', 0.25);
        $(document).mousemove(performDrag).mouseup(endDrag);
        return false;
      }

      function performDrag(e) {
        textarea.height(Math.max(32, staticOffset + e.pageY) + 'px');
        return false;
      }

      function endDrag(e) {
        $(document).unbind('mousemove', performDrag).unbind('mouseup', endDrag);
        textarea.css('opacity', 1);
      }
    });
  }
};

})(jQuery);
;
(function ($) {

/**
 * Automatically display the guidelines of the selected text format.
 */
Drupal.behaviors.filterGuidelines = {
  attach: function (context) {
    $('.filter-guidelines', context).once('filter-guidelines')
      .find(':header').hide()
      .closest('.filter-wrapper').find('select.filter-list')
      .bind('change', function () {
        $(this).closest('.filter-wrapper')
          .find('.filter-guidelines-item').hide()
          .siblings('.filter-guidelines-' + this.value).show();
      })
      .change();
  }
};

})(jQuery);
;
(function ($) {

/**
 * Toggle the visibility of a fieldset using smooth animations.
 */
Drupal.toggleFieldset = function (fieldset) {
  var $fieldset = $(fieldset);
  if ($fieldset.is('.collapsed')) {
    var $content = $('> .fieldset-wrapper', fieldset).hide();
    $fieldset
      .removeClass('collapsed')
      .trigger({ type: 'collapsed', value: false })
      .find('> legend span.fieldset-legend-prefix').html(Drupal.t('Hide'));
    $content.slideDown({
      duration: 'fast',
      easing: 'linear',
      complete: function () {
        Drupal.collapseScrollIntoView(fieldset);
        fieldset.animating = false;
      },
      step: function () {
        // Scroll the fieldset into view.
        Drupal.collapseScrollIntoView(fieldset);
      }
    });
  }
  else {
    $fieldset.trigger({ type: 'collapsed', value: true });
    $('> .fieldset-wrapper', fieldset).slideUp('fast', function () {
      $fieldset
        .addClass('collapsed')
        .find('> legend span.fieldset-legend-prefix').html(Drupal.t('Show'));
      fieldset.animating = false;
    });
  }
};

/**
 * Scroll a given fieldset into view as much as possible.
 */
Drupal.collapseScrollIntoView = function (node) {
  var h = document.documentElement.clientHeight || document.body.clientHeight || 0;
  var offset = document.documentElement.scrollTop || document.body.scrollTop || 0;
  var posY = $(node).offset().top;
  var fudge = 55;
  if (posY + node.offsetHeight + fudge > h + offset) {
    if (node.offsetHeight > h) {
      window.scrollTo(0, posY);
    }
    else {
      window.scrollTo(0, posY + node.offsetHeight - h + fudge);
    }
  }
};

Drupal.behaviors.collapse = {
  attach: function (context, settings) {
    $('fieldset.collapsible', context).once('collapse', function () {
      var $fieldset = $(this);
      // Expand fieldset if there are errors inside, or if it contains an
      // element that is targeted by the URI fragment identifier.
      var anchor = location.hash && location.hash != '#' ? ', ' + location.hash : '';
      if ($fieldset.find('.error' + anchor).length) {
        $fieldset.removeClass('collapsed');
      }

      var summary = $('<span class="summary"></span>');
      $fieldset.
        bind('summaryUpdated', function () {
          var text = $.trim($fieldset.drupalGetSummary());
          summary.html(text ? ' (' + text + ')' : '');
        })
        .trigger('summaryUpdated');

      // Turn the legend into a clickable link, but retain span.fieldset-legend
      // for CSS positioning.
      var $legend = $('> legend .fieldset-legend', this);

      $('<span class="fieldset-legend-prefix element-invisible"></span>')
        .append($fieldset.hasClass('collapsed') ? Drupal.t('Show') : Drupal.t('Hide'))
        .prependTo($legend)
        .after(' ');

      // .wrapInner() does not retain bound events.
      var $link = $('<a class="fieldset-title" href="#"></a>')
        .prepend($legend.contents())
        .appendTo($legend)
        .click(function () {
          var fieldset = $fieldset.get(0);
          // Don't animate multiple times.
          if (!fieldset.animating) {
            fieldset.animating = true;
            Drupal.toggleFieldset(fieldset);
          }
          return false;
        });

      $legend.append(summary);
    });
  }
};

})(jQuery);
;
(function ($) {

Drupal.behaviors.pathFieldsetSummaries = {
  attach: function (context) {
    $('fieldset.path-form', context).drupalSetSummary(function (context) {
      var path = $('.form-item-path-alias input', context).val();
      var automatic = $('.form-item-path-pathauto input', context).attr('checked');

      if (automatic) {
        return Drupal.t('Automatic alias');
      }
      else if (path) {
        return Drupal.t('Alias: @alias', { '@alias': path });
      }
      else {
        return Drupal.t('No alias');
      }
    });
  }
};

})(jQuery);
;
(function($) {
    'use strict';

    $.Admin = function() {
        // Élements commun
        this.elements = {
            body: $('body'),
            featuresExportAdvanced: $('#features-export-advanced'),
            verticalTabs: $('div.vertical-tabs'),
            revisionInput: $('#edit-revision'),
            blockAdmin: $('div.block-admin')
        };

        if (this.elements.body.hasClass('logged-in')) {
            // Module features : page create
            this.featuresCreate();

            // Vertical tabs : remonter l'onglet "options de publication" en haut
            this.verticalTabsHandler();

            // Activation des révisions
            if (this.elements.revisionInput.length) {
                this.elements.revisionInput.trigger('click');
            }

            // Contextual links
            if (this.elements.blockAdmin.length) {
                this.elements.blockAdmin.each(function() {
                    var blockAdmin = $(this);
                    var contextualLinks = blockAdmin.children('div.contextual-links-wrapper');
                    var blockFront = blockAdmin.find('.block');

                    blockAdmin.removeClass('contextual-links-region');
                    contextualLinks.appendTo(blockFront);
                    blockFront.addClass('contextual-links-region');
                });
            }
        }
    };

    $.Admin.prototype = {
        featuresCreate: function() {
            if (this.elements.featuresExportAdvanced.length) {
                this.elements.featuresExportAdvanced
                    .children('fieldset').removeClass('collapsed')
                    .children('.fieldset-wrapper').show();
            }
        },
        verticalTabsHandler: function() {
            // Options de publication
            if (this.elements.verticalTabs.closest('form').hasClass('node-form')) {
                this.elements.verticalTabs.find('li')
                    .removeClass('selected')
                    .removeClass('first')
                    .removeClass('last')
                    .filter(':last')
                        .prependTo(this.elements.verticalTabs.find('ul'))
                        .addClass('selected')
                        .find('a').trigger('click');
            }
        }
    };

    /**
     * onReady
     */
    $(document).ready(function() {
        new $.Admin();
    });

    /**
     * Drupal Ajax Behaviors
     */
    Drupal.behaviors.rc2c = {
        attach: function () {
            // Traduction Scald
            if (Drupal.locale.strings !== undefined) {
                var drupalLocalStrings = Drupal.locale.strings[''];
                var i18n = $('html').attr('lang');

                // FR
                if (i18n === 'fr') {
                    drupalLocalStrings['Close'] = 'Fermer';
                    drupalLocalStrings['Thumbnail'] = 'Miniature';
                    drupalLocalStrings['Edit atom properties'] = 'Éditer les propriétés du média';
                    drupalLocalStrings['View'] = 'Voir';
                    drupalLocalStrings['Edit'] = '&Eacute;diter';
                    drupalLocalStrings['Refresh'] = 'Rafraîchir';
                    drupalLocalStrings['Copy'] = 'Copier';
                    drupalLocalStrings['Cut'] = 'Couper';
                    drupalLocalStrings['Paste'] = 'Coller';
                    drupalLocalStrings['Delete'] = 'Supprimer';
                    drupalLocalStrings['Please select an atom first'] = 'Vous devez d\'abord sélectionner le média';
                    drupalLocalStrings['Add a caption'] = 'Ajouter une légende';
                    drupalLocalStrings['CSS Classes'] = 'Classes CSS';
                    drupalLocalStrings['Context'] = 'Contexte';
                    drupalLocalStrings['Alignment'] = 'Alignement';
                    drupalLocalStrings['Advanced'] = 'Avancé';
                    drupalLocalStrings['Atom Properties'] = 'Propriétés du média';
                    drupalLocalStrings['None'] = 'Aucun';
                    drupalLocalStrings['Left'] = 'Gauche';
                    drupalLocalStrings['Right'] = 'Droite';
                    drupalLocalStrings['Center'] = 'Centré';
                    drupalLocalStrings['This option is currently available for Image Atoms only.'] = 'Cette option est actuellement disponible pour les médias de type "image" seulement.';
                }
            }
        }
    };
})(jQuery);;
(function($) {
    'use strict';

    $.ThemeAdmin = function() {
        // Élements commun
        this.elements = {
            body: $('body'),
        };

        // Defaults
        this.api = {
            module: 'hackathon-api'
        };

        return this;
    };
    $.ThemeAdmin.prototype = {
        init: function() {
            var self = this;

            self.pageFunction = {
                pageHome: 'front',
                pageTaxonomyTerm: 'page-taxonomy-term'
            };

            // Pour toutes les pages
            self.pageAll();

            // Pour chaque page
            $.each(self.pageFunction, function(funcName, className) {
                if (self.elements.body.hasClass(className)) {
                    self[funcName]();
                }
            });

            if (self.elements.body.hasClass('node-type-data') && self.elements.body.hasClass('node-data-admin')) {
                self.nodeData();
            }
        },
        pageAll: function() {

        },

        /**
         * Page d'accueil
         */
        pageHome: function() {

        },

        /**
         * Page terme de taxonomie
         */
        pageTaxonomyTerm: function() {
            $.extend(this.elements, {
                sourcesFilter: $('#edit-field-thematique-datasources'),
                exportDataItem: $('#edit-field-thematique-datas').find('textarea')
            });

            var options = {self: this};
            var sources = this.elements.sourcesFilter.find('input.form-checkbox');

            if (this.elements.exportDataItem.html() === '') {
                sources
                    .filter(':checked').each(function() {
                        $(this).sourcesFilterHandler(options);
                    })
                    .on('click', function() {
                        $(this).sourcesFilterHandler(options);
                    });
            } else {
                this.importTermDataHander();
            }
        },
        importTermDataHander: function() {
            var self = this;
            var data = JSON.parse(self.elements.exportDataItem.html());

            if (typeof data === 'object') {
                // Sources
                $.each(data, function(source, bases) {
                    self.elements.sourcesFilter.find('input[value="' + source + '"]').prop('checked', true).sourcesFilterHandler({self: self});
                });

                // Bases
                $(document).ajaxComplete(function(event, xhr, settings) {
                    $.each(data, function(source, bases) {
                        if (settings.url.indexOf('/' + self.api.module + '/' + source + '/call/getBases') !== -1) {
                            $.each(bases, function(base, tables) {
                                self.elements.sourcesFilter.find('input[value="' + base + '"]').prop('checked', true).triggerHandler('click');
                            });
                        }

                        if (settings.url.indexOf('/' + self.api.module + '/' + source + '/call/getTables') !== -1) {
                            $.each(bases, function(base, tables) {
                                $.each(tables, function(index, table) {
                                    self.elements.sourcesFilter.find('input[value="' + table + '"]').prop('checked', true);
                                });
                            });
                        }
                    });

                    self.exportTermDataHandler();
                });
            }
        },
        exportTermDataHandler: function() {
            var self = this;

            // Suppression de l'existant avant génération de l'export
            self.elements.exportDataItem.empty();

            // Export
            var exportData = {};
            self.elements.sourcesFilter.find('input[type="checkbox"]').each(function() {
                var checkbox = $(this);

                if (checkbox.prop('checked')) {
                    var type = checkbox.attr('data-type');
                    var parent = checkbox.attr('data-parent');
                    var value = checkbox.val();

                    if (type === 'source') {
                        exportData[value] = {};
                    } else if (type === 'base') {
                        exportData[parent][value] = [];

                    } else if (type === 'table') {
                        var parents = (parent.indexOf('/') !== -1) ? parent.split('/') : [];

                        if (parents.length && exportData[parents[0]][parents[1]] !== undefined) {
                            exportData[parents[0]][parents[1]].push(value);
                        }
                    }

                    self.elements.exportDataItem.html(JSON.stringify(exportData));
                }
            });
        },

        /**
         * Node data (fiche de donnée)
         */
        nodeData: function() {
            $.extend(this.elements, {
                dataThematic: $('#edit-field-data-thematic'),
                dataTables: $('#edit-field-data-tables'),
                dataColumns: $('#edit-field-data-columns'),
                exportDataItem: $('#edit-field-data-filters').find('textarea')
            });

            var options = {self: this};

            this.importNodeDataHandler();

            this.elements.dataThematic.find('select')
                .thematicSelectHandler(options)
                .on('change', function() {
                    options.self.elements.dataTables.find('.form-checkboxes').empty();
                    $(this).thematicSelectHandler(options);
                });
        },
        importNodeDataHandler: function() {
            var self = this;
            var data = JSON.parse(self.elements.exportDataItem.html());

            if (typeof data === 'object') {
                $(document).ajaxComplete(function(event, xhr, settings) {
                    $.each(data, function(source, bases) {
                        // Tables
                        if (settings.url.indexOf('/hackathon-thematic-data') !== -1) {
                            $.each(bases, function(base, tables) {
                                $.each(tables, function(table, columns) {
                                    self.elements.dataTables.find('input[value="' + table + '"]').prop('checked', true).triggerHandler('click');
                                });
                            });
                        }

                        // Colonnes
                        if (settings.url.indexOf('/' + self.api.module + '/' + source + '/call/getColumnsName') !== -1) {
                            $.each(bases, function(base, tables) {
                                $.each(tables, function(table, columns) {
                                    self.elements.dataColumns.find('input[data-type="column"]').prop('checked', false);

                                    $.each(columns, function(index, column) {
                                        self.elements.dataColumns.find('input[value="' + column + '"]').prop('checked', true);
                                    });
                                });
                            });
                        }

                        self.exportNodeDataHandler();
                    });
                });
            }
        },
        exportNodeDataHandler: function() {
            var self = this;
            var exportData = {};

            // Suppression de l'existant avant génération de l'export
            self.elements.exportDataItem.empty();

            // Tables
            self.elements.dataTables.find('input[type="checkbox"]').each(function() {
                var checkbox = $(this);

                if (checkbox.prop('checked')) {
                    var type = checkbox.attr('data-type');
                    var parent = checkbox.attr('data-parent');
                    var value = checkbox.val();

                    if (type === 'table') {
                        var parents = (parent.indexOf('/') !== -1) ? parent.split('/') : [];

                        if (parents.length) {
                            if (exportData[parents[0]] === undefined) {
                                exportData[parents[0]] = {};
                            }

                            exportData[parents[0]][parents[1]] = {};
                            exportData[parents[0]][parents[1]][value] = [];
                        }
                    }
                }
            });

            // Colonnes
            self.elements.dataColumns.find('input[type="checkbox"]').each(function() {
                var checkbox = $(this);

                if (checkbox.prop('checked')) {
                    var type = checkbox.attr('data-type');
                    var parent = checkbox.attr('data-parent');
                    var value = checkbox.val();

                    if (type === 'column') {
                        var parents = (parent.indexOf('/') !== -1) ? parent.split('/') : [];

                        if (parents.length && exportData[parents[0]][parents[1]] !== undefined && exportData[parents[0]][parents[1]][parents[2]] !== undefined) {
                            exportData[parents[0]][parents[1]][parents[2]].push(value);
                        }
                    }
                }
            });

            // Export dans le champs
            self.elements.exportDataItem.html(JSON.stringify(exportData));
        }
    };

    /**
     * onReady
     */
    $(document).ready(function() {
        new $.ThemeAdmin().init();
    });

    /**
     * Drupal Ajax Behaviors
     */
    Drupal.behaviors.admin = {
        attach: function (context, settings) {
            var themeAdmin = new $.ThemeAdmin();
        }
    };

    /**
     * Gestionnaire pour sélectionner les données dans une thématiques
     *
     * @param  object options Options utilisateur
     */
    $.fn.sourcesFilterHandler = function(options) {
        var item = $(this);
        var itemContainer = item.closest('.form-item');
        options.self.exportTermDataHandler();

        if (item.prop('checked')) {
            var source = item.val();

            $.ajax({
                dataType: 'json',
                url: '/' + options.self.api.module + '/' + source + '/call/getBases',
            }).done(function(data) {

                // Template des bases
                var basesContainer = $('<div>', {
                    'class': 'item-bases-container'
                }).appendTo(itemContainer);

                var bases = $('<div>', {
                    class: 'item-container'
                }).templateAddCheckboxItems(data, {
                    type: 'base',
                    parent: source,
                    classes: 'card'
                }).appendTo(basesContainer);

                // Templates des tables
                var baseItem = bases.find('.item-base > input');

                if (baseItem.length) {
                    baseItem.on('click', function() {
                        var item = $(this);
                        var baseContainer = item.closest('.item-base');
                        options.self.exportTermDataHandler();

                        if (item.prop('checked')) {
                            var base = item.val();

                            $.ajax({
                                dataType: 'json',
                                url: '/' + options.self.api.module + '/' + source + '/call/getTables/' + base
                            }).done(function(data) {

                                var tablesContainer = $('<div>', {
                                    'class': 'item-tables-container'
                                }).appendTo(baseContainer);

                                var tables = $('<div>', {
                                    class: 'item-container card-block'
                                }).templateAddCheckboxItems(data, {
                                    type: 'table',
                                    parent: source + '/' + base
                                }).appendTo(tablesContainer);

                                var tableItemInput = tables.find('.item-table > input');
                                if (tableItemInput.length) {
                                    tableItemInput.on('click', function() {
                                        options.self.exportTermDataHandler();
                                    });
                                }

                            }).fail(function() {
                                console.error('La récupération des tables n\'a pas fonctionné.');
                            });
                        } else {
                            baseContainer.find('.item-tables-container').remove();
                        }
                    });
                }

            }).fail(function() {
                console.error('La récupération des bases n\'a pas fonctionné.');
            });
        } else {
            itemContainer.find('.item-bases-container').remove();
        }

        return this;
    };

    /**
     * Gestionnaire pour sélectionner les données dans une fiche de données en fonction de la thématique
     *
     * @param  object options Options utilisateur
     */
    $.fn.thematicSelectHandler = function(options) {
        var item = $(this);
        var tid = item.val();

        $.ajax({
            dataType: 'json',
            url: '/hackathon-thematic-data/' + tid,
        }).done(function(data) {
            var tablesContainer = options.self.elements.dataTables.find('.form-checkboxes');
            var columnsContainer = options.self.elements.dataColumns.find('.form-checkboxes');
            var maxTables = parseInt(options.self.elements.dataTables.attr('data-max'));
            var countTables = 0;

            if (typeof data === 'object') {
                $.each(data, function(source, bases) {
                    // Source
                    $('<p>', {
                        'class': 'item-source',
                        html: source
                    }).appendTo(tablesContainer);
                    options.self.exportNodeDataHandler();

                    // Bases
                    if (typeof bases === 'object') {
                        var basesContainer = $('<div>', {
                            'class': 'item-bases'
                        });

                        // Pour chaque base
                        $.each(bases, function(base, tables) {

                            // Tables
                            var tables = $('<div>', {
                                class: 'item-container card'
                            }).templateAddCheckboxItems(tables, {
                                type: 'table',
                                parent: source + '/' + base
                            }).appendTo(basesContainer);

                            $('<p>', {
                                'class': 'item-base card-header',
                                html: base
                            }).prependTo(tables);


                            // Checkbox event
                            var tablesCheckboxes = tables.find('.item-table > input');
                            tablesCheckboxes.on('click', function() {
                                var item = $(this);
                                var table = item.val();
                                var parent = item.attr('data-parent').split('/')[1];

                                // Compteur
                                if (item.prop('checked')) {
                                    countTables++;

                                    $.ajax({
                                        dataType: 'json',
                                        url: '/' + options.self.api.module + '/' + source + '/call/getColumnsName/' + parent + ',' + table
                                    }).done(function(data) {
                                        var itemContainer = $('<div>', {
                                            'class': 'card item-container item-container-' + table
                                        });

                                        $('<p>', {
                                            'class': 'item-table card-header',
                                            html: table
                                        }).appendTo(itemContainer);

                                        // Colonnes
                                        var columns = $('<div>', {
                                            class: 'item-container card-block'
                                        }).templateAddCheckboxItems(data, {
                                            type: 'column',
                                            parent: source + '/' + parent + '/' + table,
                                            checkbox: {
                                                checked: true
                                            }
                                        }).appendTo(itemContainer);

                                        // Checkbox event
                                        var columnItemInput = columns.find('.item-column > input')
                                        if (columnItemInput.length) {
                                            columnItemInput.on('click', function() {
                                                options.self.exportNodeDataHandler();
                                            });
                                        }

                                        // Add
                                        itemContainer.appendTo(columnsContainer);
                                        options.self.exportNodeDataHandler();

                                    }).fail(function() {
                                        console.error('Impossible de récupérer le nom des colonnes de la table ' + table);
                                    });
                                } else if (countTables > 0) {
                                    countTables--;

                                    columnsContainer.find('.item-container-' + table).remove();
                                    options.self.exportNodeDataHandler();
                                }

                                // Activation/Désactivation
                                tablesCheckboxes.not(':checked').attr('disabled', (countTables === maxTables));
                            });
                        });

                        basesContainer.appendTo(tablesContainer);
                    }
                });
            } else {
                console.error('Les données ne sont pas au format JSON.');
            }
        }).fail(function() {
            console.error('Impossible de récupérer les données d\'une thématique');
        });
        return this;
    };

    /**
     * Template : ajout des form-item avec checkbox/label
     *
     * @param  mixed list Liste des données pour générer les items
     * @param  object userOptions Options utilisateur
     */
    $.fn.templateAddCheckboxItems = function(list, userOptions) {
        var container = $(this);

        // Options
        var options = {
            type: undefined,
            parent: undefined,
            classes: '',
            checkbox: {
                checked: false
            }
        };
        $.extend(options, userOptions);
        if (options.type === undefined) {
            console.error('L\'option type est obligatoire.');
        }
        if (options.parent === undefined) {
            console.error('L\'option parent est obligatoire.');
        }

        // Liste
        if (typeof list === 'object' || (typeof list === 'array' && list.length)) {

            $.each(list, function(i, item) {
                var itemContainer = $('<div>', {
                    'class': 'form-item item-' + options.type + ' ' + options.classes
                });

                $('<input>', {
                    type: 'checkbox',
                    name: 'item-' + options.type + '-' + item,
                    id: 'item-' + options.type + '-' + item,
                    'data-type': options.type,
                    'data-parent': options.parent,
                    checked: options.checkbox.checked,
                    value: item
                }).appendTo(itemContainer);

                $('<label>', {
                    for: 'item-' + options.type + '-' + item,
                    'class': (options.classes == 'card') ? 'card-header' : '',
                    html: item
                }).appendTo(itemContainer);

                itemContainer.appendTo(container);
            });

        } else {
            console.error('Les données ne sont pas au format JSON.');
        }

        return this;
    };
})(jQuery);;
