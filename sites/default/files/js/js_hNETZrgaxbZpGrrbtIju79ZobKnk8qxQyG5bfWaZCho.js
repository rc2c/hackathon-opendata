Drupal.locale = { 'pluralFormula': function ($n) { return Number(($n>1)); }, 'strings': {"":{"An AJAX HTTP error occurred.":"Une erreur HTTP AJAX s\u0027est produite.","HTTP Result Code: !status":"Code de statut HTTP : !status","An AJAX HTTP request terminated abnormally.":"Une requ\u00eate HTTP AJAX s\u0027est termin\u00e9e anormalement.","Debugging information follows.":"Informations de d\u00e9bogage ci-dessous.","Path: !uri":"Chemin : !uri","StatusText: !statusText":"StatusText: !statusText","ResponseText: !responseText":"ResponseText : !responseText","ReadyState: !readyState":"ReadyState : !readyState","Next":"Suivant","Status":"Statut","Remove":"Retirer","Disabled":"D\u00e9sactiv\u00e9","Enabled":"Activ\u00e9","Edit":"Modifier","Size":"Taille","None":"Aucun(e)","Link":"Lien","Parent":"Parent","Sunday":"Dimanche","Monday":"Lundi","Tuesday":"Mardi","Wednesday":"Mercredi","Thursday":"Jeudi","Friday":"Vendredi","Saturday":"Samedi","Add":"Ajouter","View":"Voir","Filename":"Nom du fichier","Configure":"Configurer","All":"Tout","Done":"Termin\u00e9","N\/A":"N\/A","Prev":"Pr\u00e9c.","Mon":"lun","Tue":"mar","Wed":"mer","Thu":"jeu","Fri":"ven","Sat":"sam","Sun":"dim","January":"janvier","February":"F\u00e9vrier","March":"mars","April":"avril","May":"mai","June":"juin","July":"juillet","August":"ao\u00fbt","September":"septembre","October":"octobre","November":"novembre","December":"d\u00e9cembre","Operation":"Op\u00e9ration","Show":"Afficher","Select all rows in this table":"S\u00e9lectionner toutes les lignes du tableau","Deselect all rows in this table":"D\u00e9s\u00e9lectionner toutes les lignes du tableau","Today":"Aujourd\u0027hui","Jan":"jan","Feb":"f\u00e9v","Mar":"mar","Apr":"avr","Jun":"juin","Jul":"juil","Aug":"ao\u00fb","Sep":"sep","Oct":"oct","Nov":"nov","Dec":"d\u00e9c","Su":"Di","Mo":"Lu","Tu":"Ma","We":"Me","Th":"Je","Fr":"Ve","Sa":"Sa","Not published":"Non publi\u00e9","Please wait...":"Veuillez patienter...","Hide":"Masquer","mm\/dd\/yy":"dd\/mm\/yy","By @name on @date":"Par @name le @date","By @name":"Par @name","Not in menu":"Pas dans le menu","Alias: @alias":"Alias : @alias","No alias":"Aucun alias","New revision":"Nouvelle r\u00e9vision","Drag to re-order":"Cliquer-d\u00e9poser pour r\u00e9-organiser","Changes made in this table will not be saved until the form is submitted.":"Les changements effectu\u00e9s dans ce tableau ne seront pris en compte que lorsque la configuration aura \u00e9t\u00e9 enregistr\u00e9e.","The changes to these blocks will not be saved until the \u003Cem\u003ESave blocks\u003C\/em\u003E button is clicked.":"N\u0027oubliez pas de cliquer sur \u003Cem\u003EEnregistrer les blocs\u003C\/em\u003E pour confirmer les modifications apport\u00e9es ici.","No revision":"Aucune r\u00e9vision","Requires a title":"Titre obligatoire","Not restricted":"Non restreint","(active tab)":"(onglet actif)","Not customizable":"Non personnalisable","Restricted to certain pages":"R\u00e9serv\u00e9 \u00e0 certaines pages","The block cannot be placed in this region.":"Le bloc ne peut pas \u00eatre plac\u00e9 dans cette r\u00e9gion.","Hide summary":"Masquer le r\u00e9sum\u00e9","Edit summary":"Modifier le r\u00e9sum\u00e9","Don\u0027t display post information":"Ne pas afficher les informations de la contribution","The selected file %filename cannot be uploaded. Only files with the following extensions are allowed: %extensions.":"Le fichier s\u00e9lectionn\u00e9 %filename ne peut pas \u00eatre transf\u00e9r\u00e9. Seulement les fichiers avec les extensions suivantes sont permis : %extensions.","Re-order rows by numerical weight instead of dragging.":"R\u00e9-ordonner les lignes avec des poids num\u00e9riques plut\u00f4t qu\u0027en les d\u00e9pla\u00e7ant.","Show row weights":"Afficher le poids des lignes","Hide row weights":"Cacher le poids des lignes","Autocomplete popup":"Popup d\u0027auto-compl\u00e9tion","Searching for matches...":"Recherche de correspondances...","No results":"Aucun r\u00e9sultat","New":"Nouveau","Recent":"R\u00e9cent","Close":"Fermer","Loading token browser...":"Chargement de l\u0027explorateur de jetons...","Available tokens":"Jetons (tokens) disponibles","Insert this token into your form":"Ins\u00e9rer ce jeton (\u003Cem\u003Etoken\u003C\/em\u003E) dans votre formulaire","First click a text field to insert your tokens into.":"Cliquez d\u0027abord sur un champ de texte pour ins\u00e9rer vos jetons (\u003Cem\u003Etokens\u003C\/em\u003E) dans celui -ci.","Content can only be inserted into CKEditor in the WYSIWYG mode.":"Le contenu peut seulement \u00eatre ins\u00e9r\u00e9 dans CKEditor en mode WYSIWYG.","Inclusion: @value":"Inclusion : @value","Priority: @value":"Priorit\u00e9 : @value","Automatic alias":"Alias automatique","@label: @value":"@label: @value","Using defaults":"Utiliser les param\u00e8tres par d\u00e9faut.","Remove group":"Supprimer le groupe","Apply (all displays)":"Appliquer (tous les affichages)","Revert to default":"R\u00e9tablir par d\u00e9faut","Apply (this display)":"Appliquer (cet affichage)","Deselect all":"Tout d\u00e9s\u00e9lectionner","Select all":"Tout s\u00e9lectionner","Translate Text":"Traduire le texte","An HTTP error @status occured.":"Une erreur HTTP @status s\u0027est produite.","Thumbnail":"Miniature","You can\u0027t drop a resource of type %type in this field":"Vous ne pouvez pas d\u00e9poser une ressource du type %type dans ce champ","Edit atom properties":"\u0026Eacute;diter les propri\u00e9t\u00e9s du m\u00e9dia","Drop a resource from Scald media library here.":"D\u00e9posez une ressource \u00e0 partir de la librairie de m\u00e9dia.","Start upload":"D\u00e9marrer le transfert","CustomMessage: !customMessage":"Message personalis\u00e9 : !customMessage","The response failed verification so will not be processed.":"La v\u00e9rification de la r\u00e9ponse \u00e0 \u00e9chou\u00e9e, elle ne sera pas trait\u00e9e.","The callback URL is not local and not trusted: !url":"L\u0027URL de retour n\u0027est pas locale et n\u0027est pas de confiance : !url","Saving vote...":"Enregistrement du vote ...","Blank":"Vide","Link Target":"Cible du Lien","Select files":"S\u00e9lectionner des fichiers","Add files":"Ajouter des fichiers","Stop current upload":"Arr\u00eater le transfert en cours","Start uploading queue":"Commencer le transfert de la file","Uploaded %d\/%d files":"%d\/%d fichiers transf\u00e9r\u00e9s","Drag files here.":"Glisser des fichiers ici.","Init error.":"Erreur lors de l\u0027initialisation.","HTTP Error.":"Erreur HTTP.","Security error.":"Erreur de s\u00e9curit\u00e9.","Generic error.":"Erreur g\u00e9n\u00e9rique.","IO error.":"Erreur d\u0027entr\u00e9es\/sorties.","Stop upload":"Arr\u00eater le transfert","%d files queued":"%d fichiers ajout\u00e9s dans la file","Please wait while your files are being uploaded.":"Veuillez patienter pendant le transfert de vos fichiers."}} };;
(function ($) {

/**
 * Attaches double-click behavior to toggle full path of Krumo elements.
 */
Drupal.behaviors.devel = {
  attach: function (context, settings) {

    // Add hint to footnote
    $('.krumo-footnote .krumo-call').once().before('<img style="vertical-align: middle;" title="Click to expand. Double-click to show path." src="' + settings.basePath + 'misc/help.png"/>');

    var krumo_name = [];
    var krumo_type = [];

    function krumo_traverse(el) {
      krumo_name.push($(el).html());
      krumo_type.push($(el).siblings('em').html().match(/\w*/)[0]);

      if ($(el).closest('.krumo-nest').length > 0) {
        krumo_traverse($(el).closest('.krumo-nest').prev().find('.krumo-name'));
      }
    }

    $('.krumo-child > div:first-child', context).dblclick(
      function(e) {
        if ($(this).find('> .krumo-php-path').length > 0) {
          // Remove path if shown.
          $(this).find('> .krumo-php-path').remove();
        }
        else {
          // Get elements.
          krumo_traverse($(this).find('> a.krumo-name'));

          // Create path.
          var krumo_path_string = '';
          for (var i = krumo_name.length - 1; i >= 0; --i) {
            // Start element.
            if ((krumo_name.length - 1) == i)
              krumo_path_string += '$' + krumo_name[i];

            if (typeof krumo_name[(i-1)] !== 'undefined') {
              if (krumo_type[i] == 'Array') {
                krumo_path_string += "[";
                if (!/^\d*$/.test(krumo_name[(i-1)]))
                  krumo_path_string += "'";
                krumo_path_string += krumo_name[(i-1)];
                if (!/^\d*$/.test(krumo_name[(i-1)]))
                  krumo_path_string += "'";
                krumo_path_string += "]";
              }
              if (krumo_type[i] == 'Object')
                krumo_path_string += '->' + krumo_name[(i-1)];
            }
          }
          $(this).append('<div class="krumo-php-path" style="font-family: Courier, monospace; font-weight: bold;">' + krumo_path_string + '</div>');

          // Reset arrays.
          krumo_name = [];
          krumo_type = [];
        }
      }
    );
  }
};

})(jQuery);
;
(function ($) {

/**
 * Attaches the autocomplete behavior to all required fields.
 */
Drupal.behaviors.autocomplete = {
  attach: function (context, settings) {
    var acdb = [];
    $('input.autocomplete', context).once('autocomplete', function () {
      var uri = this.value;
      if (!acdb[uri]) {
        acdb[uri] = new Drupal.ACDB(uri);
      }
      var $input = $('#' + this.id.substr(0, this.id.length - 13))
        .attr('autocomplete', 'OFF')
        .attr('aria-autocomplete', 'list');
      $($input[0].form).submit(Drupal.autocompleteSubmit);
      $input.parent()
        .attr('role', 'application')
        .append($('<span class="element-invisible" aria-live="assertive"></span>')
          .attr('id', $input.attr('id') + '-autocomplete-aria-live')
        );
      new Drupal.jsAC($input, acdb[uri]);
    });
  }
};

/**
 * Prevents the form from submitting if the suggestions popup is open
 * and closes the suggestions popup when doing so.
 */
Drupal.autocompleteSubmit = function () {
  return $('#autocomplete').each(function () {
    this.owner.hidePopup();
  }).length == 0;
};

/**
 * An AutoComplete object.
 */
Drupal.jsAC = function ($input, db) {
  var ac = this;
  this.input = $input[0];
  this.ariaLive = $('#' + this.input.id + '-autocomplete-aria-live');
  this.db = db;

  $input
    .keydown(function (event) { return ac.onkeydown(this, event); })
    .keyup(function (event) { ac.onkeyup(this, event); })
    .blur(function () { ac.hidePopup(); ac.db.cancel(); });

};

/**
 * Handler for the "keydown" event.
 */
Drupal.jsAC.prototype.onkeydown = function (input, e) {
  if (!e) {
    e = window.event;
  }
  switch (e.keyCode) {
    case 40: // down arrow.
      this.selectDown();
      return false;
    case 38: // up arrow.
      this.selectUp();
      return false;
    default: // All other keys.
      return true;
  }
};

/**
 * Handler for the "keyup" event.
 */
Drupal.jsAC.prototype.onkeyup = function (input, e) {
  if (!e) {
    e = window.event;
  }
  switch (e.keyCode) {
    case 16: // Shift.
    case 17: // Ctrl.
    case 18: // Alt.
    case 20: // Caps lock.
    case 33: // Page up.
    case 34: // Page down.
    case 35: // End.
    case 36: // Home.
    case 37: // Left arrow.
    case 38: // Up arrow.
    case 39: // Right arrow.
    case 40: // Down arrow.
      return true;

    case 9:  // Tab.
    case 13: // Enter.
    case 27: // Esc.
      this.hidePopup(e.keyCode);
      return true;

    default: // All other keys.
      if (input.value.length > 0 && !input.readOnly) {
        this.populatePopup();
      }
      else {
        this.hidePopup(e.keyCode);
      }
      return true;
  }
};

/**
 * Puts the currently highlighted suggestion into the autocomplete field.
 */
Drupal.jsAC.prototype.select = function (node) {
  this.input.value = $(node).data('autocompleteValue');
  $(this.input).trigger('autocompleteSelect', [node]);
};

/**
 * Highlights the next suggestion.
 */
Drupal.jsAC.prototype.selectDown = function () {
  if (this.selected && this.selected.nextSibling) {
    this.highlight(this.selected.nextSibling);
  }
  else if (this.popup) {
    var lis = $('li', this.popup);
    if (lis.length > 0) {
      this.highlight(lis.get(0));
    }
  }
};

/**
 * Highlights the previous suggestion.
 */
Drupal.jsAC.prototype.selectUp = function () {
  if (this.selected && this.selected.previousSibling) {
    this.highlight(this.selected.previousSibling);
  }
};

/**
 * Highlights a suggestion.
 */
Drupal.jsAC.prototype.highlight = function (node) {
  if (this.selected) {
    $(this.selected).removeClass('selected');
  }
  $(node).addClass('selected');
  this.selected = node;
  $(this.ariaLive).html($(this.selected).html());
};

/**
 * Unhighlights a suggestion.
 */
Drupal.jsAC.prototype.unhighlight = function (node) {
  $(node).removeClass('selected');
  this.selected = false;
  $(this.ariaLive).empty();
};

/**
 * Hides the autocomplete suggestions.
 */
Drupal.jsAC.prototype.hidePopup = function (keycode) {
  // Select item if the right key or mousebutton was pressed.
  if (this.selected && ((keycode && keycode != 46 && keycode != 8 && keycode != 27) || !keycode)) {
    this.select(this.selected);
  }
  // Hide popup.
  var popup = this.popup;
  if (popup) {
    this.popup = null;
    $(popup).fadeOut('fast', function () { $(popup).remove(); });
  }
  this.selected = false;
  $(this.ariaLive).empty();
};

/**
 * Positions the suggestions popup and starts a search.
 */
Drupal.jsAC.prototype.populatePopup = function () {
  var $input = $(this.input);
  var position = $input.position();
  // Show popup.
  if (this.popup) {
    $(this.popup).remove();
  }
  this.selected = false;
  this.popup = $('<div id="autocomplete"></div>')[0];
  this.popup.owner = this;
  $(this.popup).css({
    top: parseInt(position.top + this.input.offsetHeight, 10) + 'px',
    left: parseInt(position.left, 10) + 'px',
    width: $input.innerWidth() + 'px',
    display: 'none'
  });
  $input.before(this.popup);

  // Do search.
  this.db.owner = this;
  this.db.search(this.input.value);
};

/**
 * Fills the suggestion popup with any matches received.
 */
Drupal.jsAC.prototype.found = function (matches) {
  // If no value in the textfield, do not show the popup.
  if (!this.input.value.length) {
    return false;
  }

  // Prepare matches.
  var ul = $('<ul></ul>');
  var ac = this;
  for (key in matches) {
    $('<li></li>')
      .html($('<div></div>').html(matches[key]))
      .mousedown(function () { ac.hidePopup(this); })
      .mouseover(function () { ac.highlight(this); })
      .mouseout(function () { ac.unhighlight(this); })
      .data('autocompleteValue', key)
      .appendTo(ul);
  }

  // Show popup with matches, if any.
  if (this.popup) {
    if (ul.children().length) {
      $(this.popup).empty().append(ul).show();
      $(this.ariaLive).html(Drupal.t('Autocomplete popup'));
    }
    else {
      $(this.popup).css({ visibility: 'hidden' });
      this.hidePopup();
    }
  }
};

Drupal.jsAC.prototype.setStatus = function (status) {
  switch (status) {
    case 'begin':
      $(this.input).addClass('throbbing');
      $(this.ariaLive).html(Drupal.t('Searching for matches...'));
      break;
    case 'cancel':
    case 'error':
    case 'found':
      $(this.input).removeClass('throbbing');
      break;
  }
};

/**
 * An AutoComplete DataBase object.
 */
Drupal.ACDB = function (uri) {
  this.uri = uri;
  this.delay = 300;
  this.cache = {};
};

/**
 * Performs a cached and delayed search.
 */
Drupal.ACDB.prototype.search = function (searchString) {
  var db = this;
  this.searchString = searchString;

  // See if this string needs to be searched for anyway. The pattern ../ is
  // stripped since it may be misinterpreted by the browser.
  searchString = searchString.replace(/^\s+|\.{2,}\/|\s+$/g, '');
  // Skip empty search strings, or search strings ending with a comma, since
  // that is the separator between search terms.
  if (searchString.length <= 0 ||
    searchString.charAt(searchString.length - 1) == ',') {
    return;
  }

  // See if this key has been searched for before.
  if (this.cache[searchString]) {
    return this.owner.found(this.cache[searchString]);
  }

  // Initiate delayed search.
  if (this.timer) {
    clearTimeout(this.timer);
  }
  this.timer = setTimeout(function () {
    db.owner.setStatus('begin');

    // Ajax GET request for autocompletion. We use Drupal.encodePath instead of
    // encodeURIComponent to allow autocomplete search terms to contain slashes.
    $.ajax({
      type: 'GET',
      url: db.uri + '/' + Drupal.encodePath(searchString),
      dataType: 'json',
      success: function (matches) {
        if (typeof matches.status == 'undefined' || matches.status != 0) {
          db.cache[searchString] = matches;
          // Verify if these are still the matches the user wants to see.
          if (db.searchString == searchString) {
            db.owner.found(matches);
          }
          db.owner.setStatus('found');
        }
      },
      error: function (xmlhttp) {
        Drupal.displayAjaxError(Drupal.ajaxError(xmlhttp, db.uri));
      }
    });
  }, this.delay);
};

/**
 * Cancels the current autocomplete request.
 */
Drupal.ACDB.prototype.cancel = function () {
  if (this.owner) this.owner.setStatus('cancel');
  if (this.timer) clearTimeout(this.timer);
  this.searchString = '';
};

})(jQuery);
;
(function($) {
    'use strict';

    $.Admin = function() {
        // Élements commun
        this.elements = {
            body: $('body'),
            featuresExportAdvanced: $('#features-export-advanced'),
            verticalTabs: $('div.vertical-tabs'),
            revisionInput: $('#edit-revision'),
            blockAdmin: $('div.block-admin')
        };

        if (this.elements.body.hasClass('logged-in')) {
            // Module features : page create
            this.featuresCreate();

            // Vertical tabs : remonter l'onglet "options de publication" en haut
            this.verticalTabsHandler();

            // Activation des révisions
            if (this.elements.revisionInput.length) {
                this.elements.revisionInput.trigger('click');
            }

            // Contextual links
            if (this.elements.blockAdmin.length) {
                this.elements.blockAdmin.each(function() {
                    var blockAdmin = $(this);
                    var contextualLinks = blockAdmin.children('div.contextual-links-wrapper');
                    var blockFront = blockAdmin.find('.block');

                    blockAdmin.removeClass('contextual-links-region');
                    contextualLinks.appendTo(blockFront);
                    blockFront.addClass('contextual-links-region');
                });
            }
        }
    };

    $.Admin.prototype = {
        featuresCreate: function() {
            if (this.elements.featuresExportAdvanced.length) {
                this.elements.featuresExportAdvanced
                    .children('fieldset').removeClass('collapsed')
                    .children('.fieldset-wrapper').show();
            }
        },
        verticalTabsHandler: function() {
            // Options de publication
            if (this.elements.verticalTabs.closest('form').hasClass('node-form')) {
                this.elements.verticalTabs.find('li')
                    .removeClass('selected')
                    .removeClass('first')
                    .removeClass('last')
                    .filter(':last')
                        .prependTo(this.elements.verticalTabs.find('ul'))
                        .addClass('selected')
                        .find('a').trigger('click');
            }
        }
    };

    /**
     * onReady
     */
    $(document).ready(function() {
        new $.Admin();
    });

    /**
     * Drupal Ajax Behaviors
     */
    Drupal.behaviors.rc2c = {
        attach: function () {
            // Traduction Scald
            if (Drupal.locale.strings !== undefined) {
                var drupalLocalStrings = Drupal.locale.strings[''];
                var i18n = $('html').attr('lang');

                // FR
                if (i18n === 'fr') {
                    drupalLocalStrings['Close'] = 'Fermer';
                    drupalLocalStrings['Thumbnail'] = 'Miniature';
                    drupalLocalStrings['Edit atom properties'] = 'Éditer les propriétés du média';
                    drupalLocalStrings['View'] = 'Voir';
                    drupalLocalStrings['Edit'] = '&Eacute;diter';
                    drupalLocalStrings['Refresh'] = 'Rafraîchir';
                    drupalLocalStrings['Copy'] = 'Copier';
                    drupalLocalStrings['Cut'] = 'Couper';
                    drupalLocalStrings['Paste'] = 'Coller';
                    drupalLocalStrings['Delete'] = 'Supprimer';
                    drupalLocalStrings['Please select an atom first'] = 'Vous devez d\'abord sélectionner le média';
                    drupalLocalStrings['Add a caption'] = 'Ajouter une légende';
                    drupalLocalStrings['CSS Classes'] = 'Classes CSS';
                    drupalLocalStrings['Context'] = 'Contexte';
                    drupalLocalStrings['Alignment'] = 'Alignement';
                    drupalLocalStrings['Advanced'] = 'Avancé';
                    drupalLocalStrings['Atom Properties'] = 'Propriétés du média';
                    drupalLocalStrings['None'] = 'Aucun';
                    drupalLocalStrings['Left'] = 'Gauche';
                    drupalLocalStrings['Right'] = 'Droite';
                    drupalLocalStrings['Center'] = 'Centré';
                    drupalLocalStrings['This option is currently available for Image Atoms only.'] = 'Cette option est actuellement disponible pour les médias de type "image" seulement.';
                }
            }
        }
    };
})(jQuery);;
(function($) {
    'use strict';

    $.ThemeAdmin = function() {
        // Élements commun
        this.elements = {
            body: $('body'),
        };

        // Defaults
        this.api = {
            module: 'hackathon-api'
        };

        return this;
    };
    $.ThemeAdmin.prototype = {
        init: function() {
            var self = this;

            self.pageFunction = {
                pageHome: 'front',
                nodeData: 'node-type-data',
                pageTaxonomyTerm: 'page-taxonomy-term'
            };

            // Pour toutes les pages
            self.pageAll();

            // Pour chaque page
            $.each(self.pageFunction, function(funcName, className) {
                if (self.elements.body.hasClass(className)) {
                    self[funcName]();
                }
            });
        },
        pageAll: function() {

        },

        /**
         * Page d'accueil
         */
        pageHome: function() {

        },

        /**
         * Page terme de taxonomie
         */
        pageTaxonomyTerm: function() {
            $.extend(this.elements, {
                sourcesFilter: $('#edit-field-thematique-datasources'),
                exportDataItem: $('#edit-field-thematique-datas').find('textarea')
            });

            var options = {self: this};
            var sources = this.elements.sourcesFilter.find('input.form-checkbox');

            if (this.elements.exportDataItem.html() === '') {
                sources
                    .filter(':checked').each(function() {
                        $(this).sourcesFilterHandler(options);
                    })
                    .on('click', function() {
                        $(this).sourcesFilterHandler(options);
                    });
            } else {
                this.importTermDataHander();
            }
        },
        importTermDataHander: function() {
            var self = this;
            var data = JSON.parse(self.elements.exportDataItem.html());

            if (typeof data === 'object') {
                // Sources
                $.each(data, function(source, bases) {
                    self.elements.sourcesFilter.find('input[value="' + source + '"]').prop('checked', true).sourcesFilterHandler({self: self});
                });

                // Bases
                $(document).ajaxComplete(function(event, xhr, settings) {
                    $.each(data, function(source, bases) {
                        if (settings.url.indexOf('/' + self.api.module + '/' + source + '/call/getBases') !== -1) {
                            $.each(bases, function(base, tables) {
                                self.elements.sourcesFilter.find('input[value="' + base + '"]').prop('checked', true).triggerHandler('click');
                            });
                        }

                        if (settings.url.indexOf('/' + self.api.module + '/' + source + '/call/getTables') !== -1) {
                            $.each(bases, function(base, tables) {
                                $.each(tables, function(index, table) {
                                    self.elements.sourcesFilter.find('input[value="' + table + '"]').prop('checked', true);
                                });
                            });
                        }
                    });

                    self.exportTermDataHandler();
                });
            }
        },
        exportTermDataHandler: function() {
            var self = this;

            // Suppression de l'existant avant génération de l'export
            self.elements.exportDataItem.empty();

            // Export
            var exportData = {};
            self.elements.sourcesFilter.find('input[type="checkbox"]').each(function() {
                var checkbox = $(this);

                if (checkbox.prop('checked')) {
                    var type = checkbox.attr('data-type');
                    var parent = checkbox.attr('data-parent');
                    var value = checkbox.val();

                    if (type === 'source') {
                        exportData[value] = {};
                    } else if (type === 'base') {
                        exportData[parent][value] = [];

                    } else if (type === 'table') {
                        var parents = (parent.indexOf('/') !== -1) ? parent.split('/') : [];

                        if (parents.length && exportData[parents[0]][parents[1]] !== undefined) {
                            exportData[parents[0]][parents[1]].push(value);
                        }
                    }

                    self.elements.exportDataItem.html(JSON.stringify(exportData));
                }
            });
        },

        /**
         * Node data (fiche de donnée)
         */
        nodeData: function() {
            $.extend(this.elements, {
                dataThematic: $('#edit-field-data-thematic'),
                dataTables: $('#edit-field-data-tables'),
                dataColumns: $('#edit-field-data-columns'),
                exportDataItem: $('#edit-field-data-filters').find('textarea')
            });

            var options = {self: this};

            this.importNodeDataHandler();

            this.elements.dataThematic.find('select')
                .thematicSelectHandler(options)
                .on('change', function() {
                    options.self.elements.dataTables.find('.form-checkboxes').empty();
                    $(this).thematicSelectHandler(options);
                });
        },
        importNodeDataHandler: function() {
            var self = this;
            var data = JSON.parse(self.elements.exportDataItem.html());

            if (typeof data === 'object') {
                $(document).ajaxComplete(function(event, xhr, settings) {
                    $.each(data, function(source, bases) {
                        // Tables
                        if (settings.url.indexOf('/hackathon-thematic-data') !== -1) {
                            $.each(bases, function(base, tables) {
                                $.each(tables, function(table, columns) {
                                    self.elements.dataTables.find('input[value="' + table + '"]').prop('checked', true).triggerHandler('click');
                                });
                            });
                        }

                        // Colonnes
                        if (settings.url.indexOf('/' + self.api.module + '/' + source + '/call/getColumnsName') !== -1) {
                            $.each(bases, function(base, tables) {
                                $.each(tables, function(table, columns) {
                                    self.elements.dataColumns.find('input[data-type="column"]').prop('checked', false);

                                    $.each(columns, function(index, column) {
                                        self.elements.dataColumns.find('input[value="' + column + '"]').prop('checked', true);
                                    });
                                });
                            });
                        }

                        self.exportNodeDataHandler();
                    });
                });
            }
        },
        exportNodeDataHandler: function() {
            var self = this;
            var exportData = {};

            // Suppression de l'existant avant génération de l'export
            self.elements.exportDataItem.empty();

            // Tables
            self.elements.dataTables.find('input[type="checkbox"]').each(function() {
                var checkbox = $(this);

                if (checkbox.prop('checked')) {
                    var type = checkbox.attr('data-type');
                    var parent = checkbox.attr('data-parent');
                    var value = checkbox.val();

                    if (type === 'table') {
                        var parents = (parent.indexOf('/') !== -1) ? parent.split('/') : [];

                        if (parents.length) {
                            if (exportData[parents[0]] === undefined) {
                                exportData[parents[0]] = {};
                            }

                            exportData[parents[0]][parents[1]] = {};
                            exportData[parents[0]][parents[1]][value] = [];
                        }
                    }
                }
            });

            // Colonnes
            self.elements.dataColumns.find('input[type="checkbox"]').each(function() {
                var checkbox = $(this);

                if (checkbox.prop('checked')) {
                    var type = checkbox.attr('data-type');
                    var parent = checkbox.attr('data-parent');
                    var value = checkbox.val();

                    if (type === 'column') {
                        var parents = (parent.indexOf('/') !== -1) ? parent.split('/') : [];

                        if (parents.length && exportData[parents[0]][parents[1]] !== undefined && exportData[parents[0]][parents[1]][parents[2]] !== undefined) {
                            exportData[parents[0]][parents[1]][parents[2]].push(value);
                        }
                    }
                }
            });

            // Export dans le champs
            self.elements.exportDataItem.html(JSON.stringify(exportData));
        }
    };

    /**
     * onReady
     */
    $(document).ready(function() {
        new $.ThemeAdmin().init();
    });

    /**
     * Drupal Ajax Behaviors
     */
    Drupal.behaviors.admin = {
        attach: function (context, settings) {
            var themeAdmin = new $.ThemeAdmin();
        }
    };

    /**
     * Gestionnaire pour sélectionner les données dans une thématiques
     *
     * @param  object options Options utilisateur
     */
    $.fn.sourcesFilterHandler = function(options) {
        var item = $(this);
        var itemContainer = item.closest('.form-item');
        options.self.exportTermDataHandler();

        if (item.prop('checked')) {
            var source = item.val();

            $.ajax({
                dataType: 'json',
                url: '/' + options.self.api.module + '/' + source + '/call/getBases',
            }).done(function(data) {

                // Template des bases
                var basesContainer = $('<div>', {
                    'class': 'item-bases-container'
                }).appendTo(itemContainer);

                var bases = $('<div>', {
                    class: 'item-container'
                }).templateAddCheckboxItems(data, {
                    type: 'base',
                    parent: source,
                    classes: 'card'
                }).appendTo(basesContainer);

                // Templates des tables
                var baseItem = bases.find('.item-base > input');

                if (baseItem.length) {
                    baseItem.on('click', function() {
                        var item = $(this);
                        var baseContainer = item.closest('.item-base');
                        options.self.exportTermDataHandler();

                        if (item.prop('checked')) {
                            var base = item.val();

                            $.ajax({
                                dataType: 'json',
                                url: '/' + options.self.api.module + '/' + source + '/call/getTables/' + base
                            }).done(function(data) {

                                var tablesContainer = $('<div>', {
                                    'class': 'item-tables-container'
                                }).appendTo(baseContainer);

                                var tables = $('<div>', {
                                    class: 'item-container card-block'
                                }).templateAddCheckboxItems(data, {
                                    type: 'table',
                                    parent: source + '/' + base
                                }).appendTo(tablesContainer);

                                var tableItemInput = tables.find('.item-table > input');
                                if (tableItemInput.length) {
                                    tableItemInput.on('click', function() {
                                        options.self.exportTermDataHandler();
                                    });
                                }

                            }).fail(function() {
                                console.error('La récupération des tables n\'a pas fonctionné.');
                            });
                        } else {
                            baseContainer.find('.item-tables-container').remove();
                        }
                    });
                }

            }).fail(function() {
                console.error('La récupération des bases n\'a pas fonctionné.');
            });
        } else {
            itemContainer.find('.item-bases-container').remove();
        }

        return this;
    };

    /**
     * Gestionnaire pour sélectionner les données dans une fiche de données en fonction de la thématique
     *
     * @param  object options Options utilisateur
     */
    $.fn.thematicSelectHandler = function(options) {
        var item = $(this);
        var tid = item.val();

        $.ajax({
            dataType: 'json',
            url: '/hackathon-thematic-data/' + tid,
        }).done(function(data) {
            var tablesContainer = options.self.elements.dataTables.find('.form-checkboxes');
            var columnsContainer = options.self.elements.dataColumns.find('.form-checkboxes');
            var maxTables = parseInt(options.self.elements.dataTables.attr('data-max'));
            var countTables = 0;

            if (typeof data === 'object') {
                $.each(data, function(source, bases) {
                    // Source
                    $('<p>', {
                        'class': 'item-source',
                        html: source
                    }).appendTo(tablesContainer);
                    options.self.exportNodeDataHandler();

                    // Bases
                    if (typeof bases === 'object') {
                        var basesContainer = $('<div>', {
                            'class': 'item-bases'
                        });

                        // Pour chaque base
                        $.each(bases, function(base, tables) {

                            // Tables
                            var tables = $('<div>', {
                                class: 'item-container card'
                            }).templateAddCheckboxItems(tables, {
                                type: 'table',
                                parent: source + '/' + base
                            }).appendTo(basesContainer);

                            $('<p>', {
                                'class': 'item-base card-header',
                                html: base
                            }).prependTo(tables);


                            // Checkbox event
                            var tablesCheckboxes = tables.find('.item-table > input');
                            tablesCheckboxes.on('click', function() {
                                var item = $(this);
                                var table = item.val();
                                var parent = item.attr('data-parent').split('/')[1];

                                // Compteur
                                if (item.prop('checked')) {
                                    countTables++;

                                    $.ajax({
                                        dataType: 'json',
                                        url: '/' + options.self.api.module + '/' + source + '/call/getColumnsName/' + parent + ',' + table
                                    }).done(function(data) {
                                        var itemContainer = $('<div>', {
                                            'class': 'card item-container item-container-' + table
                                        });

                                        $('<p>', {
                                            'class': 'item-table card-header',
                                            html: table
                                        }).appendTo(itemContainer);

                                        // Colonnes
                                        var columns = $('<div>', {
                                            class: 'item-container card-block'
                                        }).templateAddCheckboxItems(data, {
                                            type: 'column',
                                            parent: source + '/' + parent + '/' + table,
                                            checkbox: {
                                                checked: true
                                            }
                                        }).appendTo(itemContainer);

                                        // Checkbox event
                                        var columnItemInput = columns.find('.item-column > input')
                                        if (columnItemInput.length) {
                                            columnItemInput.on('click', function() {
                                                options.self.exportNodeDataHandler();
                                            });
                                        }

                                        // Add
                                        itemContainer.appendTo(columnsContainer);
                                        options.self.exportNodeDataHandler();

                                    }).fail(function() {
                                        console.error('Impossible de récupérer le nom des colonnes de la table ' + table);
                                    });
                                } else if (countTables > 0) {
                                    countTables--;

                                    columnsContainer.find('.item-container-' + table).remove();
                                    options.self.exportNodeDataHandler();
                                }

                                // Activation/Désactivation
                                tablesCheckboxes.not(':checked').attr('disabled', (countTables === maxTables));
                            });
                        });

                        basesContainer.appendTo(tablesContainer);
                    }
                });
            } else {
                console.error('Les données ne sont pas au format JSON.');
            }
        }).fail(function() {
            console.error('Impossible de récupérer les données d\'une thématique');
        });
        return this;
    };

    /**
     * Template : ajout des form-item avec checkbox/label
     *
     * @param  mixed list Liste des données pour générer les items
     * @param  object userOptions Options utilisateur
     */
    $.fn.templateAddCheckboxItems = function(list, userOptions) {
        var container = $(this);

        // Options
        var options = {
            type: undefined,
            parent: undefined,
            classes: '',
            checkbox: {
                checked: false
            }
        };
        $.extend(options, userOptions);
        if (options.type === undefined) {
            console.error('L\'option type est obligatoire.');
        }
        if (options.parent === undefined) {
            console.error('L\'option parent est obligatoire.');
        }

        // Liste
        if (typeof list === 'object' || (typeof list === 'array' && list.length)) {

            $.each(list, function(i, item) {
                var itemContainer = $('<div>', {
                    'class': 'form-item item-' + options.type + ' ' + options.classes
                });

                $('<input>', {
                    type: 'checkbox',
                    name: 'item-' + options.type + '-' + item,
                    id: 'item-' + options.type + '-' + item,
                    'data-type': options.type,
                    'data-parent': options.parent,
                    checked: options.checkbox.checked,
                    value: item
                }).appendTo(itemContainer);

                $('<label>', {
                    for: 'item-' + options.type + '-' + item,
                    'class': (options.classes == 'card') ? 'card-header' : '',
                    html: item
                }).appendTo(itemContainer);

                itemContainer.appendTo(container);
            });

        } else {
            console.error('Les données ne sont pas au format JSON.');
        }

        return this;
    };
})(jQuery);;
